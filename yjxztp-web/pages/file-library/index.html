<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>文件库</title>
  <link rel="stylesheet" href="../../assets/plugins/layui/css/layui.css">
  <link rel="stylesheet" href="../../assets/css/common.css">
  <link rel="stylesheet" href="../../assets/plugins/layui/layui_exts/dropDown/dropDown.css">
  <link rel="stylesheet" href="../../assets/icon/iconfont.css">
  <style>
    html,
    body {
      height: 100%;
    }

    body {
      display: flex;
      overflow: hidden;
    }

    .container {
      display: inline-block;
      flex: 1;
    }

    .tag-box {
      margin-top: 50px;
    }

    .tag-title {
      height: 48px;
      line-height: 48px;
      font-size: 18px;
      display: flex;
      justify-content: space-between;
      padding-right: 30px;
    }

    .tag-title-left {
      color: #0077FF;
    }

    .tag-title-left i {
      font-size: 18px;
    }

    .tag-title-setting {
      color: #99A3BC;
      cursor: pointer;
    }

    .tag-title-setting i {
      font-size: 18px;
    }

    .tag-list {
      padding-left: 24px;
    }

    .tag-item {
      height: 48px;
      line-height: 48px;
      display: flex;
      justify-content: space-between;
      padding-right: 25px;
    }

    .tag-item i {
      color: #99A3BC;
      font-size: 20px;
      cursor: pointer;
    }

    .color-tag {
      display: flex;
      width: 65%;
    }

    .color-circle {
      width: 15px;
    }

    .color-name {
      display: inline-block;
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .all-tag {
      position: relative;
    }

    .all-tag span:first-child {
      position: absolute;
      top: 20px;
      left: -6px;
      z-index: 999;
      border: 1px solid #fff;
    }

    .create-tag {
      color: #0077FF;
      display: block;
      line-height: 48px;
      height: 48px;
      padding-left: 24px;
      font-size: 16px;
      cursor: pointer;
    }

    .layui-layer {
      width: 20%;
    }

    #chooseTag,
    #addTag {
      display: none;
      height: 300px;
    }

    #publicTag {
      height: 260px;
      display: none;
      overflow: auto;
    }
  </style>
</head>

<body>
  <div class="slide-menu">
    <p><i class="font_family icon-wenjianku"></i>文件库</p>
    <ul class="menu-list">
      <li class="menu-item active" data-href="./recent-view.html">最近浏览</li>
      <li class="menu-item" data-href="./my-library.html">我的文件库</li>
      <li class="menu-item" data-href="./share-file.html">分享文件</li>
      <li class="menu-item" data-href="./project-file.html">项目文件</li>
      <li class="menu-item" data-href="./recycle-bin.html">回收站</li>
    </ul>
    <div class="tag-box">
      <div class="tag-title">
        <div class="tag-title-left">
          <i class="font_family icon-fenpeibiaoqian"></i>
          <span>标签</span>
        </div>
        <div class="tag-title-setting" data-method="offset" data-type="auto">
          <i class="font_family icon-shezhi"></i>
        </div>
      </div>
      <span class="create-tag" data-method="offset" data-type="auto">+ 新建标签</span>
      <ul class="tag-list">
        <li class="tag-item">
          <div class="color-tag">
            <div class="color-circle">
              <span class="layui-badge-dot layui-bg-blue"></span>
            </div>
            <span class="color-name" title="蓝色蓝色蓝色蓝色">蓝色蓝色蓝色蓝色</span>
          </div>
          <div>
            <span class="layui-badge">6</span>
          </div>
          <i class="font_family icon-gengduo" data-dropdown="1"></i>
        </li>
        <li class="tag-item">
          <div class="color-tag">
            <div class="color-circle">
              <span class="layui-badge-dot layui-bg-red"></span>
            </div>
            <span class="color-name" title="红色">红色</span>
          </div>
          <div>
            <span class="layui-badge">20</span>
          </div>
          <i class="font_family icon-gengduo" data-dropdown="2"></i>
        </li>
        <li class="tag-item">
          <div class="color-tag">
            <div class="color-circle">
              <span class="layui-badge-dot layui-bg-orange"></span>
            </div>
            <span class="color-name" title="黄色">黄色</span>
          </div>
          <div>
            <span class="layui-badge">49</span>
          </div>
          <i class="font_family icon-gengduo" data-dropdown="3"></i>
        </li>
        <li class="tag-item">
          <div class="all-tag color-tag">
            <div class="color-circle">
              <span class="layui-badge-dot layui-bg-black"></span>
              <span class="layui-badge-dot layui-bg-black"></span>
            </div>
            <span class="color-name">所有标签</span>
          </div>
          <div>
            <span class="layui-badge">120</span>
          </div>
          <i class="font_family icon-xia"></i>
        </li>
      </ul>
    </div>

  </div>
  <div id="chooseTag">
    <div id="colorSelect"></div>
  </div>
  <div id="addTag">
    <div id="addSelect"></div>
  </div>
  <div id="publicTag">
    <div class="publicTree">
    </div>
  </div>
  <div class="container">
    <iframe style="width: 100%;height: 100%;" src="./recent-view.html" id="iframe" frameborder="0"></iframe>
  </div>
  <!-- 颜色选择 -->
  <div id="colorpicker" style="display: none;">
    <div class="tag-color-form">
      <form class="layui-form" action="" lay-filter="tag-confirm">
        <div class="layui-form-item">
          <div class="layui-input-inline" style="width: 169px;">
            <input name="name" type="text" value="" lay-verify="required" autocomplete="off" placeholder="请输入标签名"
              class="layui-input">
          </div>
          <div class="layui-inline" style="left: -11px;">
            <div id="tag-color"></div>
          </div>
        </div>
        <div class="layui-input-block" style="margin-left:0px;text-align:center;">
          <button type="button" class="layui-btn layui-btn-sm" lay-submit="" lay-filter="tag-confirm">确认</button>
          <button type="button" class="layui-btn layui-btn-primary layui-btn-sm" id="tag-cancel">取消</button>
        </div>
      </form>
    </div>
  </div>
  <script src="../../assets/js/jquery-1.9.1.min.js"></script>
  <script src="../../assets/plugins/layui/layui.js"></script>
  <script>
    layui.config({
      base: '../../assets/plugins/layui/layui_exts/dropDown/'
    }).use(['dropDown', 'layer', 'colorpicker', 'form', 'tree'], function () {
      var dropDown = layui.dropDown,
        layer = layui.layer,
        tree = layui.tree,
        colorpicker = layui.colorpicker,
        form = layui.form;
      // 左导航下拉菜单
      var dropDownData = [
        { 'type': 1, 'title': '编辑', 'icon': 'bianji' },
        { 'type': 2, 'title': '删除', 'icon': 'shanchu' }
      ];
      $('.tag-list').on('click', '.tag-item .icon-gengduo',function () {
        var ele = $(this);
        var dropDownEle = dropDown.render({
          ele: ele, // 绑定下拉菜单的元素 （jq对象）
          position: 'right', // 下拉菜单定位 默认 bottom 类型：top、left、right、bottom
          className: 'my-drop', //自定义class 可根据此class自定义样式 默认为 空
          showIcon: true, //是否显示图标 默认false
          iconType: 'font_family icon', //icon图标类型 layui-icon layui自带图标；默认为 layui-icon，也可以是其他图标库的前缀
          zIndex: 1999, // 下拉层级 默认值999
          clickClose: true, //点击下拉菜单选项是否关闭下拉菜单 默认true
          mouseleaveClose: false, // 鼠标离开下拉菜单下拉菜单是否隐藏 默认true
          data: dropDownData, // 下拉菜单的数据
          choose: function (data) { // 点击回调
            if (data.title === '编辑') {
              var colorpickerDom = $("#colorpicker");
              var tagColorLayer = layer.open({
                type: 1,
                title: '编辑标签',
                resize: false,
                move: false,
                content: colorpickerDom,
                success: function () {
                  colorpicker.render({
                    elem: '#tag-color',
                    color: '#eb2f96',
                    predefine: true, //开启预定义颜色
                    alpha: true, //开启透明度
                    format: 'rgb',
                    colors: ['#eb2f96', '#f5222d', '#fa8c16', '#52c41a', '#13c2c2', '#1890ff', '#722ed1'], //自定义预定义颜色项

                    done: function (color) {
                      newColor = color;
                    }
                  });

                  $('#tag-cancel').on('click', function () {
                    layer.close(tagColorLayer);
                  });
                  form.val("tag-confirm", {
                    name: ''
                  })
                  form.render();

                  form.on('submit(tag-confirm)', function (data) {
                    newTagData = {
                      color: newColor ? newColor : defaultColor,
                      name: data.field.name,
                      value: (new Date()).valueOf()
                    }
                    // updateTag(newTagData);
                    layer.close(tagColorLayer);
                  });
                }
              });
            }
          }
        });
      });
      //新建标签弹窗
      var newTagData = {
        name: '',
        value: '',
        color: ''
      },
        defaultColor = '#eb2f96',
        newColor = '';
      var active = {
        offset: function (othis) {
          var type = othis.data('type')
            , text = othis.text();
          layer.open({
            triggerEle: othis // 触发弹窗的元素 jq对象
            , type: 1
            , offset: type //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
            , id: 'layerDemo' + type //防止重复弹出
            // , content: '<div style="padding: 20px">' + text + '</div>'
            , content: $('#addTag')
            , btn: '确定'
            , title: '将标签分配给'
            , fixed: false
            , skin: 'layui-layer-radius'
            , resize: false
            , move: false // 禁止拖动
            , btnAlign: 'c' //按钮居中
            , shade: 0 //0不显示遮罩,
            , shadeClose: true
            , yes: function () {
              layer.closeAll();
            },
          });
        }
      };

      $('.create-tag').on('click', function () {
        var colorpickerDom = $("#colorpicker");
        var tagColorLayer = layer.open({
          type: 1,
          resize: false,
          move: false,// 禁止拖动
          title: '新建标签',
          content: colorpickerDom,
          success: function () {
            colorpicker.render({
              elem: '#tag-color',
              color: '#eb2f96',
              predefine: true, //开启预定义颜色
              alpha: true, //开启透明度
              format: 'rgb',
              colors: ['#eb2f96', '#f5222d', '#fa8c16', '#52c41a', '#13c2c2', '#1890ff', '#722ed1'], //自定义预定义颜色项

              done: function (color) {
                newColor = color;
              }
            });

            $('#tag-cancel').on('click', function () {
              layer.close(tagColorLayer);
            });
            form.val("tag-confirm", {
              name: ''
            })
            form.render();

            form.on('submit(tag-confirm)', function (data) {
              newTagData = {
                color: newColor ? newColor : defaultColor,
                name: data.field.name,
                value: (new Date()).valueOf()
              }
              // updateTag(newTagData);
              layer.close(tagColorLayer);
            });
          }
        });
      });


      // 分配公有标签
      var treeData = [{
        title: '公有标签'
        , id: 1
        , color: '#FB3B35' //颜色
        , level: 1 //级数
        , children: [{
          title: '标签一一'
          , id: 1000
          , color: '#45C5B1'
          , children: [{
            title: '标签一一一'
            , id: 10001
            , color: '#0077FF'
          }, {
            title: '标签一一二'
            , id: 10002
            , color: '#0077FF'
          }]
        }, {
          title: '标签一二'
          , id: 1001
          , color: '#0077FF'
        }, {
          title: '标签一三'
          , id: 1002
          , color: '#0077FF'
        }]
      }];
      tree.render({
        elem: '#publicTag'
        , data: treeData
        , edit: ['add', 'update', 'del'] //操作节点的图标
        , delNoneLevel: 1 //设置第几级节点不允许删除操作(根据数据中的level)
        , updateNoneLevel: 1 //设置第几级节点不允许编辑操作(根据数据中的level)
        , showLine: false
        , template: function (item) {
          var str = '';
          if (item.level == 1) {
            str = '<div class="layui-tree-tag"><span>' + item.title + '</span></div>'
          } else {
            str = '<div class="layui-tree-tag"><span class="layui-tree-tag-graph layui-tree-tag-diamond" style="background-color: ' + item.color + '"></span><span>' + item.title + '</span></div>'
          }
          return str
        }
        , click: function (obj) {
          layer.msg(JSON.stringify(obj.data));
        }
        , customOperate: true // 是否开启自定义操作事件
        , operate: function (obj) {
          var colorpickerDom = $("#colorpicker");
          if (obj.type == "add") {

            var tagColorLayer = layer.open({
              type: 1,
              title: '新建公有标签',
              resize: false,
              move: false,
              content: colorpickerDom,
              success: function () {
                colorpicker.render({
                  elem: '#tag-color',
                  color: '#eb2f96',
                  predefine: true, //开启预定义颜色
                  alpha: true, //开启透明度
                  format: 'rgb',
                  colors: ['#eb2f96', '#f5222d', '#fa8c16', '#52c41a', '#13c2c2', '#1890ff', '#722ed1'], //自定义预定义颜色项

                  done: function (color) {
                    newColor = color;
                  }
                });

                $('#tag-cancel').on('click', function () {
                  layer.close(tagColorLayer);
                });
                form.val("tag-confirm", {
                  name: ''
                })
                form.render();

                form.on('submit(tag-confirm)', function (data) {
                  newTagData = {
                    color: newColor ? newColor : defaultColor,
                    name: data.field.name,
                    value: (new Date()).valueOf()
                  }
                  // updateTag(newTagData);
                  layer.close(tagColorLayer);
                });
              }
            });
          } else if (obj.type == "update") {
            var tagColorLayer = layer.open({
              type: 1,
              title: '编辑公有标签',
              resize: false,
              move: false,
              content: colorpickerDom,
              success: function () {
                colorpicker.render({
                  elem: '#tag-color',
                  color: '#eb2f96',
                  predefine: true, //开启预定义颜色
                  alpha: true, //开启透明度
                  format: 'rgb',
                  colors: ['#eb2f96', '#f5222d', '#fa8c16', '#52c41a', '#13c2c2', '#1890ff', '#722ed1'], //自定义预定义颜色项

                  done: function (color) {
                    newColor = color;
                  }
                });

                $('#tag-cancel').on('click', function () {
                  layer.close(tagColorLayer);
                });
                form.val("tag-confirm", {
                  name: ''
                })
                form.render();
                form.on('submit(tag-confirm)', function (data) {
                  newTagData = {
                    color: newColor ? newColor : defaultColor,
                    name: data.field.name,
                    value: (new Date()).valueOf()
                  }
                  // updateTag(newTagData);
                  layer.close(tagColorLayer);
                });
              }
            });
          } else if (obj.type == "del") {
            layer.confirm('是否删除“' + obj.data.title + '”节点', { icon: 3, title: '提示' }, function (index) {
              //do something

              layer.close(index);
            });
          }
          console.log(obj);
        }
      });
      var publicTagChoose = {
        offset: function (othis) {
          var type = othis.data('type')
            , text = othis.text();
          layer.open({
            triggerEle: othis // 触发弹窗的元素 jq对象
            , type: 1
            , offset: 'er' //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
            , id: 'layerDemo' + type //防止重复弹出
            // , content: '<div style="padding: 20px">' + text + '</div>'
            , content: $('#publicTag')
            , title: '设置公有标签'
            , fixed: false
            , skin: 'layui-layer-radius'
            , move: false // 禁止拖动
            , btnAlign: 'c' //按钮居中
            , shade: 0.001 //0不显示遮罩,
            , shadeClose: true
            , resize: false
            , yes: function () {
              layer.closeAll();
            },
          });
        }
      };
      $('.tag-title-setting').on('click', function () {
        var othis = $(this),
          method = othis.data('method');
        publicTagChoose[method] ? publicTagChoose[method].call(this, othis) : '';
      })


    });

    $(".menu-item").on("click", function () {
      var title = document.title.split("-");
      title[1] = $(this).text();
      document.title = title.join("-");
      $("#iframe").attr("src", $(this).attr("data-href"));
      $(".menu-item").removeClass("active");
      $(this).addClass("active");
    });
  </script>
</body>

</html>
